import{b as H,c as Y,g as Z,h as q,i as J,j as Q,l as X,m as ee}from"./chunk-TDO7E7QQ.js";import{i as K}from"./chunk-O6IA54B3.js";import{$ as A,Aa as ie,C as y,I as f,K as x,L as M,M as O,N as D,O as r,P as l,Q as h,R as C,T as m,U as d,X as k,Y as a,_ as R,aa as P,b as g,ba as _,da as V,ea as z,g as S,ga as U,j as b,l as p,la as W,m as u,ta as B,u as j,ua as $,v as s,va as L,wa as G,xa as T,y as N,ya as F,za as te}from"./chunk-WHZMVVWQ.js";import"./chunk-ECBXVGWK.js";var w=class o{storage=b(te);getStorageReference(t){return G(this.storage,t)}uploadFileResult(t){let e=this.getStorageReference(t.path),i=$(e,t.file).then(()=>L(e));return g(i)}getUrl(t){return g(L(t))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var E=class o{functions=b(ie);setRoleClaims(t,e){let i=T(this.functions.app),n=F(i,"setCustomClaims");return g(n({idToken:t,role:e}))}onRoleSelected(){let t=T(this.functions.app),e=F(t,"onRoleSelect");return g(e())}static \u0275fac=function(e){return new(e||o)};static \u0275prov=S({token:o,factory:o.\u0275fac,providedIn:"root"})};var oe=()=>[1,2,3,4],re=(o,t)=>({finished:o,active:t}),le=()=>["fas","user"];function se(o,t){if(o&1&&(r(0,"div",6),h(1,"fa-icon",9),l()),o&2){let e=t.$implicit,i=d(2),n=_(2);f("ngClass",z(2,re,e<n,e===n)),s(),f("icon",i.stepIcons[e-1])}}function ae(o,t){if(o&1){let e=C();r(0,"h4",10),a(1,"Wprowad\u017A kod weryfikacyjny"),l(),r(2,"h5",11),a(3),l(),h(4,"input",12,0),r(6,"button",13),m("click",function(){p(e);let n=k(5),c=d(2);return u(c.verifyEmailCode(n.value))}),a(7," Zweryfikuj kod "),l(),r(8,"button",14),m("click",function(){p(e);let n=d(2),c=_(0);return u(n.sendEmailVerification(c))}),a(9," Wy\u015Blij ponownie "),l()}if(o&2){let e=d(2),i=_(0);s(3),R("Na adres mailowy ",i.email," zosta\u0142 wys\u0142any mail z kodem autoryzuj\u0105cym. "),s(3),f("disabled",e.userEmailVerified()||e.isLoading()),s(2),f("disabled",e.userEmailVerified()||e.isLoading())}}function ce(o,t){if(o&1){let e=C();r(0,"h4",15),a(1,"Wybierz rol\u0119"),l(),r(2,"button",16),m("click",function(){p(e);let n=d(2),c=_(1);return u(n.updateUserRole(n.Role.User,c))}),a(3," U\u017Cytkownik "),l(),r(4,"button",16),m("click",function(){p(e);let n=d(2),c=_(1);return u(n.updateUserRole(n.Role.Vet,c))}),a(5," Weterynarz "),l()}if(o&2){let e=d(2);s(2),f("disabled",!!e.userRole()||e.isLoading()),s(2),f("disabled",!!e.userRole()||e.isLoading())}}function de(o,t){if(o&1){let e=C();r(0,"div",10)(1,"label",17),a(2," Nazwa u\u017Cytkownika "),l(),r(3,"div",18),h(4,"input",19,1),r(6,"button",20),m("click",function(){p(e);let n=k(5),c=d(2),v=_(0);return u(c.updateAuthDisplayName(n.value,v))}),a(7),l()()(),r(8,"div",10)(9,"label",21),a(10,"Email"),l(),h(11,"input",22),l()}if(o&2){let e=d(2),i=_(0);s(4),f("value",i.displayName),s(2),f("disabled",i.displayName||e.isLoading()),s(),R(" ",i.displayName?"Confirmed":"Confirm"," "),s(4),f("value",i.email)}}function pe(o,t){if(o&1){let e=C();r(0,"section",3)(1,"div",5),O(2,se,2,5,"div",6,M),r(4,"button",7),m("click",function(){p(e);let n=d();return u(n.currentStep.set(1))}),a(5," Krok 1 "),l(),r(6,"button",7),m("click",function(){p(e);let n=d();return u(n.currentStep.set(2))}),a(7," Krok 2 "),l(),r(8,"button",7),m("click",function(){p(e);let n=d();return u(n.currentStep.set(3))}),a(9," Krok 3 "),l(),r(10,"button",7),m("click",function(){p(e);let n=d();return u(n.currentStep.set(4))}),a(11," Krok 4 "),l(),r(12,"h6"),a(13,"Rejestracja konta"),l(),r(14,"h6"),a(15,"Weryfikacja e-mail"),l(),r(16,"h6"),a(17,"Rola"),l(),r(18,"h6"),a(19,"Profil"),l()(),r(20,"div",8),y(21,ae,10,3)(22,ce,6,2)(23,de,12,4),l()()}if(o&2){let e=d(),i=_(1);s(2),D(V(3,oe)),s(19),x(e.currentStep()===2?21:-1),s(),x(e.currentStep()===3&&i?22:-1),s(),x(e.currentStep()===4?23:-1)}}function ue(o,t){if(o&1){let e=C();r(0,"input",23,2),m("change",function(n){p(e);let c=d(2),v=_(0);return u(c.handleFileSelection(n,v))}),l(),r(2,"div",24)(3,"div",25),h(4,"img",26),r(5,"button",27),m("click",function(){p(e);let n=k(1);return u(n.click())}),h(6,"fa-icon",28),l()()()}if(o&2){d(2);let e=_(0);s(4),f("src",e.photoURL||"assets/placeholder.svg",j),s(2),f("icon",V(2,le))}}function me(o,t){if(o&1&&y(0,ue,7,3),o&2){d();let e=_(0);x(e?0:-1)}}var I=class o{authService=b(B);storageService=b(w);functionsService=b(E);stepIcons=[X,J,Q,Z,q];Role=ee;user=this.authService.user;userEmailVerified=this.authService.isEmailVerified;userToken=this.authService.userToken;userRole=this.authService.userRole;userName=this.authService.userDisplayName;userPhoto=this.authService.userPhoto;userProfileCompleted=this.authService.isProfileCompleted;isLoading=U(()=>!1);currentStep=U(()=>{let t=this.user(),e=this.userEmailVerified(),i=this.userToken(),n=this.userRole(),c=this.userProfileCompleted(),v=this.userName();if(c&&v)return 5;if(c)return 4;if(e&&i&&!n)return 3;if(t&&!e)return console.log(t,e),2;if(t)return 1;this.authService.logout()});handleFileSelection(t,e){let n=t.target.files;if(n){let c={file:n[0],path:`users/${e.uid}/profilePic.jpg`};this.updateStoragePhotoUrl(c,e)}}updateStoragePhotoUrl(t,e){this.isLoading.set(!0),this.storageService.uploadFileResult(t).subscribe({next:i=>this.updateAuthPhotoUrl(i,e),error:i=>console.error(i),complete:()=>{console.log("storagePhoto updated"),this.isLoading.set(!1)}})}updateAuthPhotoUrl(t,e){this.isLoading.set(!0),this.authService.updateProfileData({photoURL:t},e).subscribe({next:()=>this.userPhoto.set(t),error:i=>console.error(i),complete:()=>{this.isLoading.set(!1),console.log("authProfile photoUrl updated")}})}updateAuthDisplayName(t,e){this.isLoading.set(!0),this.authService.updateProfileData({displayName:t},e).subscribe({next:()=>{this.authService.userDisplayName.set(t)},error:i=>console.error(i),complete:()=>{this.isLoading.set(!1),console.log("authProfile name updated")}})}sendEmailVerification(t){this.isLoading.set(!0),this.authService.initiateEmail(t).subscribe({next:()=>{console.log("email sent")},error:e=>{console.error(e)},complete:()=>{this.isLoading.set(!1),console.log("stream completed")}})}verifyEmailCode(t){this.isLoading.set(!0),this.authService.applyEmailVerificationCode(t).subscribe({next:()=>{console.log("email verified"),this.authService.isEmailVerified.set(!0)},error:e=>{console.error(e),this.isLoading.set(!1)},complete:()=>{this.isLoading.set(!1),console.log("stream completed")}})}updateUserRole(t,e){this.isLoading.set(!0),this.functionsService.setRoleClaims(e,t).subscribe({next:()=>{console.log("update role succsess"),this.authService.userRole.set(t)},error:i=>{console.error(i)},complete:()=>{this.isLoading.set(!1),console.log("stream completed")}})}selectRole(){this.functionsService.onRoleSelected().subscribe({next:t=>{console.log(t)},error:t=>{console.error(t)},complete:()=>{console.log("stream completed")}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=N({type:o,selectors:[["app-profile"]],decls:7,vars:4,consts:[["codeInput",""],["userPhotoUrlInput",""],["inputField",""],[1,"container"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"grid-steps","m-5","text-center"],[1,"step-bar",3,"ngClass"],["type","button","disabled","",1,"btn","btn-link","p-0","text-decoration-none",3,"click"],[1,"bg-white","shadow","rounded-3","p-5","w-50","mx-auto"],[1,"step-icon",3,"icon"],[1,"mb-3"],[1,"mb-4"],["type","text","placeholder","Kod weryfikacyjny",1,"form-control","mb-3"],["type","button",1,"btn","btn-primary","w-100","mb-3",3,"click","disabled"],["type","button",1,"text-primary","bg-transparent","border-0",3,"click","disabled"],[1,"text-center","px-2"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["for","userPhotoUrlInput",1,"form-label"],[1,"input-group"],["type","text","id","userPhotoUrlInput","placeholder","name","aria-label","username","aria-describedby","userPhotoUrlInput",1,"form-control",3,"value"],["type","button","id","userPhotoUrlInput",1,"btn","btn-outline-secondary",3,"click","disabled"],["for","emailInput",1,"form-label"],["type","email","id","emailInput","placeholder","email","disabled","",1,"form-control",3,"value"],["hidden","","type","file","id","file","accept","image/png, image/jpeg",3,"change"],[1,"p-5","profile-sidebar","position-relative","mb-5"],[1,"position-absolute","top-100","start-50","translate-middle"],["width","126","alt","profile",1,"border","border-5","border-white","rounded-circle","img-fluid","position-relative",3,"src"],["type","button",1,"btn","btn-sm","btn-outline-secondary","border-0","position-absolute","bottom-0","end-0",3,"click"],[3,"icon"]],template:function(e,i){if(e&1){let n=C();A(0)(1)(2),y(3,pe,24,4,"section",3)(4,me,1,1),r(5,"button",4),m("click",function(){return p(n),u(i.selectRole())}),a(6,"Button do call function"),l()}if(e&2){let n=P(i.user());s(),P(i.userToken()),s();let c=P(i.currentStep());s(),x(c&&n&&i.currentStep()!==5?3:4)}},dependencies:[K,Y,H,W],styles:[".grid-steps[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;grid-template-rows:3rem;align-items:center;font-size:1.5rem}.step-bar[_ngcontent-%COMP%]{display:flex;justify-content:center;position:relative;height:2px;background-color:#e9ecef;transition:background-color .3s ease}.step-bar.finished[_ngcontent-%COMP%]{background-color:#2ecc71a8}.step-bar.active[_ngcontent-%COMP%]{background-color:#4361eec2}.step-bar.active[_ngcontent-%COMP%]   .step-icon[_ngcontent-%COMP%]{background-color:#4361ee;box-shadow:0 0 0 5px #4361ee33}.step-icon[_ngcontent-%COMP%]{position:absolute;width:3rem;display:flex;justify-content:center;align-items:center;color:#fff;font-weight:700;border-radius:50%;background-color:#e9ecef;aspect-ratio:1/1;transform:translateY(-50%)!important}.step-bar.finished[_ngcontent-%COMP%]   .step-icon[_ngcontent-%COMP%]{background-color:#2ecc71}.profile-sidebar[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4158d0,#c850c0)}.img-fluid[_ngcontent-%COMP%]{height:128px}"],changeDetection:0})};export{I as default};
